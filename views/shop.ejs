<%- include("partials/header") %>

<div class="login-container"
  <% if (user && user.theme_bg) { %>
    style="background-image:url('/images/shop/<%= user.theme_bg %>'); background-size:cover; background-position:center;"
  <% } %>
>
  <div class="login-box shop-box">
    <h2>Shop</h2>
    <p class="login-subtitle">Buy beautifull avatars and backgrounds pics</p>

    <a href="/dashboard" class="back-btn"> Back to Dashboard</a>


    <div class="xp-coins">
      <p><strong> Coins:</strong> <%= user.coins || 0 %></p>
    </div>


    <% if (error) { %>
      <p class="login-error"><%= error %></p>
    <% } %>
    <% if (msg) { %>
      <p class="login-msg"><%= msg %></p>
    <% } %>


    <% if (items && items.length > 0) { %>
      <div class="shop-items">
        <% items.forEach(item => { %>
          <div class="shop-item">
            <% if (item.name.toLowerCase().includes("avatar")) { %>
              <img src="/images/shop/<%= item.image %>" alt="<%= item.name %>" class="shop-image">
            <% } else { %>
              <img src="/images/shop/<%= item.image %>" alt="<%= item.name %>" class="shop-bg-image">
            <% } %>

            <div class="shop-details">
              <h3><%= item.name %></h3>
              <p><%= item.description || "" %></p>
              <p><strong><%= item.price %> coins</strong></p>

              <% if (ownedIds.includes(item.id)) { %>
                <% if (
                  (user.avatar && user.avatar.includes(item.image)) ||
                  (user.theme_bg && user.theme_bg === item.image)
                ) { %>
                  <button disabled class="equipped-btn">Equipped</button>
                <% } else { %>
                  <form action="/shop/equip/<%= item.id %>" method="POST">
                    <button type="submit" class="submit_knapp">Equip</button>
                  </form>
                <% } %>
              <% } else { %>
                <form action="/shop/buy/<%= item.id %>" method="POST">
                  <button type="submit" class="submit_knapp">Buy</button>
                </form>
              <% } %>
            </div>
          </div>
        <% }) %>
      </div>
    <% } else { %>
      <p>No items found in shop.</p>
    <% } %>
  </div>
</div>

<%- include("partials/footer") %>
